version: "3.3"
services:

  schuetzen-app:
    image: wordpress:latest
    container_name: schuetzen-app
    restart: always
    links:
    - schuetzen-db
    networks:
      - traefik_proxy
    environment:
      - WORDPRESS_DB_HOST=schuetzen-db
      - WORDPRESS_DB_NAME=sv
      - WORDPRESS_DB_USER=sv
      - WORDPRESS_DB_PASSWORD=${WORDPRESS_DB_PASSWORD}
      - ZABBIX_HOSTNAME=schuetzen-app
      - VIRTUAL_HOST=sv.${DOMAINNAME}
      - LETSENCRYPT_HOST=sv.${DOMAINNAME}
      - LETSENCRYPT_EMAIL=eddie.faf@googlemail.com
    volumes:
      - ${DATADIR}/site3/data:/var/www/html
      - ${DATADIR}/site3/logs/:/www/logs
    expose:
      - 80
    labels:
      - traefik.enable=true
      - traefik.backend=sv
      - traefik.frontend.rule=Host:sv.${DOMAINNAME}

  schuetzen-db:
    image: tiredofit/mariadb
    container_name: schuetzen-db
    restart: always
    volumes:
      - ${DATADIR}/site3/db:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_USER=sv
      - MYSQL_DATABASE=sv
      - MYSQL_PASSWORD=${WORDPRESS_DB_PASSWORD}
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - ZABBIX_HOSTNAME=schuetzen-db
    networks:
      - traefik_proxy

  schuetzen-db-backup:
    container_name: schuetzen-db-backup
    image: tiredofit/mariadb-backup
    restart: always
    links:
     - schuetzen-db
    volumes:
      - ${DATADIR}/site3/dbbackups:/backups
    environment:
      - DB_SERVER=schuetzen-db
      - DB_TYPE=mysql
      - DB_NAME=sv
      - DB_USER=sv
      - DB_PASSWORD=${WORDPRESS_DB_PASSWORD}
      - DB_DUMP_FREQ=1440
      - DB_DUMP_BEGIN=0000
      - DB_CLEANUP_TIME=8640
      - COMPRESSION=BZ
      - SPLIT_DB=FALSE
    networks:
      - traefik_proxy

networks:
  traefik_proxy:
    external:
      name: traefik_proxy

